# name: TimestampTo unix conversion
# description: Checks if the conversion from human readable timestamp formats to unix timestamps works
# groups: [Function]

# SUCCESS CASES

CREATE LOGICAL SOURCE TSSTREAM(TSSTR VARSIZED);
CREATE PHYSICAL SOURCE FOR TSSTREAM TYPE File;
ATTACH INLINE
1970-01-01T00:00:00Z
1970-01-01T00:00:01Z
1970-01-01T00:00:01.234Z
1970-01-01T01:00:00+01:00
2021-12-14T15:05:03
2026-02-16T12:00:00Z
9999-12-31T23:59:59.999Z


SELECT CASTTOUNIXTS(`TSSTREAM$TSSTR`) AS TSMS FROM TSSTREAM INTO FILE();
----
0
1000
1234
0
1639494303000
1771243200000
253402300799999


# ERROR CASES

# just a string no timestamp
CREATE LOGICAL SOURCE TSSTREAM_ERR1(TSSTR VARSIZED);
CREATE PHYSICAL SOURCE FOR TSSTREAM_ERR1 TYPE File;
ATTACH INLINE
not-a-timestamp


SELECT CASTTOUNIXTS(`TSSTREAM_ERR1$TSSTR`) AS TSMS FROM TSSTREAM_ERR1 INTO FILE();
----
Error 4005

# illegal tailing string
CREATE LOGICAL SOURCE TSSTREAM_ERR2(TSSTR VARSIZED);
CREATE PHYSICAL SOURCE FOR TSSTREAM_ERR2 TYPE File;
ATTACH INLINE
1970-01-01T00:00:00Zabc


SELECT CASTTOUNIXTS(`TSSTREAM_ERR2$TSSTR`) AS TSMS FROM TSSTREAM_ERR2 INTO FILE();
----
Error 4005


# illegal format
CREATE LOGICAL SOURCE TSSTREAM_ERR3(TSSTR VARSIZED);
CREATE PHYSICAL SOURCE FOR TSSTREAM_ERR3 TYPE File;
ATTACH INLINE
1969-12-31T23:59:59Z


SELECT CASTTOUNIXTS(`TSSTREAM_ERR3$TSSTR`) AS TSMS FROM TSSTREAM_ERR3 INTO FILE();
----
Error 4005



# empty string as timestamp
CREATE LOGICAL SOURCE TSSTREAM_ERR4(TSSTR VARSIZED);
CREATE PHYSICAL SOURCE FOR TSSTREAM_ERR4 TYPE File;
ATTACH INLINE
" "

SELECT CASTTOUNIXTS(`TSSTREAM_ERR4$TSSTR`) AS TSMS FROM TSSTREAM_ERR4 INTO FILE();
----
Error 4005
