# name: function/boolean/FunctionAnd.test
# description: Simple function and tests
# groups: [Function, FunctionAnd]


# We define a source that has for all signed data types the 1, for all unsigned data types the 2, and for all float data types the 3.
CREATE LOGICAL SOURCE stream(i8 INT8 NOT NULL, i16 INT16 NOT NULL, i32 INT32 NOT NULL, i64 INT64 NOT NULL, u8 UINT8 NOT NULL, u16 UINT16 NOT NULL, u32 UINT32 NOT NULL, u64 UINT64 NOT NULL, f32 FLOAT32 NOT NULL, f64 FLOAT64 NOT NULL);
CREATE PHYSICAL SOURCE FOR stream TYPE File;
ATTACH INLINE
1,1,1,1,2,2,2,2,3,3

CREATE SINK sink4Booleans(a BOOLEAN NOT NULL, b BOOLEAN NOT NULL, c BOOLEAN NOT NULL, d BOOLEAN NOT NULL)  TYPE File;
CREATE SINK sink8Booleans(a BOOLEAN NOT NULL, b BOOLEAN NOT NULL, c BOOLEAN NOT NULL, d BOOLEAN NOT NULL, e BOOLEAN NOT NULL, f BOOLEAN NOT NULL, g BOOLEAN NOT NULL, h BOOLEAN NOT NULL)  TYPE File;


# Check if the and operator works for no nested functions
SELECT
    (i8 == INT32(2)) and (i16 == INT32(2)) AS a,
    (i32 == INT32(2)) and (i64 == INT32(1)) AS b,
    (u8 == INT32(2)) and (i64 == INT32(2)) AS c,
    (u8 == INT32(2)) and (u16 == INT32(2)) AS d
FROM stream INTO sink4Booleans;
----
0,0,0,1


# Check if the and operator works for simple nested functions
SELECT
    (i8 == INT32(1)) and ((i16 == INT32(1)) and (i32 == INT32(1))) AS a,
    (i32 == INT32(1)) and ((i64 == INT32(1)) and (u8 == INT32(2))) AS b,
    (u8 == INT32(2)) and ((u16 == INT32(1)) and (u32 == INT32(2))) AS c,
    (u8 == INT32(2)) and ((u16 == INT32(1)) and (u32 == INT32(2))) AS d,
    (i8 == INT32(1)) and not ((i16 == INT32(1)) and (i32 == INT32(1))) AS e,
    (i32 == INT32(1)) and not ((i64 == INT32(1)) and (u8 == INT32(2))) AS f,
    (u8 == INT32(2)) and not ((u16 == INT32(1)) and (u32 == INT32(2))) AS g,
    (u8 == INT32(2)) and not ((u16 == INT32(1)) and (i32 == INT32(2))) AS h
FROM stream INTO sink8Booleans;
----
1,1,0,0,0,0,1,1

# Check if the and operator works together with comparison functions
SELECT
    (i8 == INT32(1)) and (i16 < INT32(2)) AS a,
    (i32 == INT32(1)) and (i64 > INT32(0)) AS b,
    (u8 == INT32(2)) and (u16 <= INT32(2)) AS c,
    (u8 == INT32(2)) and (u16 >= INT32(2)) AS d,
    (i8 == INT32(1)) and not (i16 == INT32(1)) AS e,
    (i32 == INT32(1)) and not (i64 == INT32(1)) AS f,
    (u8 == INT32(2)) and not (u16 == INT32(1)) AS g,
    (u8 == INT32(2)) and not (u16 == INT32(2)) AS h
FROM stream INTO sink8Booleans;
----
1,1,1,1,0,0,1,0


# Check if the and operator works together with comparison functions and nested functions
SELECT
    (i8 == INT32(1)) and ((i16 < INT32(2)) and (i32 == INT32(1))) AS a,
    (i32 == INT32(1)) and ((i64 > INT32(0)) and (u8 == INT32(2))) AS b,
    (u8 == INT32(2)) and ((u16 <= INT32(2)) and (u32 == INT32(2))) AS c,
    (u8 == INT32(2)) and ((u16 >= INT32(2)) and (u32 == INT32(2))) AS d,
    (i8 == INT32(1)) and not ((i16 == INT32(1)) and (i32 == INT32(1))) AS e,
    (i32 == INT32(1)) and not ((i64 == INT32(1)) and (u8 == INT32(2))) AS f,
    (u8 == INT32(2)) and not ((u16 == INT32(1)) and (u32 == INT32(2))) AS g,
    (u8 == INT32(2)) and not ((u16 == INT32(1)) and (i32 == INT32(2))) AS h
FROM stream INTO sink8Booleans;
----
1,1,1,1,0,0,1,1

# Check that AND works with raw boolean fields
CREATE LOGICAL SOURCE boolStream(flag1 BOOLEAN NOT NULL, flag2 BOOLEAN NOT NULL, value INT32 NOT NULL);
CREATE PHYSICAL SOURCE FOR boolStream TYPE File;
ATTACH INLINE
true,true,1
true,false,2
false,true,3
false,false,4

CREATE SINK sinkBoolAnd(a BOOLEAN NOT NULL, b BOOLEAN NOT NULL, c BOOLEAN NOT NULL) TYPE File;

SELECT
    flag1 AND flag2 AS a,
    flag1 AND (value == INT32(1)) AS b,
    (value > INT32(2)) AND flag2 AS c
FROM boolStream INTO sinkBoolAnd;
----
1,1,0
0,0,0
0,0,1
0,0,0
