# name: formatter/JSON/SIMDJSON.test
# description: Queries to test behavior specific to the SIMDJSON input formatter
# groups: [json, large]

# Background: The SIMDJSON ondemand parser requires a batch_size configuration that must not be exceeded
# Test: The SIMDJSON input format indexer throws the correct exception if it receives a buffer larger than its batch_size
# How: The default batch_size of SIMDJSON is 100000. We set our buffer size to '1048576' and ingest a file that contains
#      more than '1048576' bytes

GlobalConfiguration worker.default_query_execution.operator_buffer_size: [1048576]

CREATE LOGICAL SOURCE windTurbines(producerId INT32, groupId INT32, producedPower FLOAT64, timestamp UINT64);
CREATE PHYSICAL SOURCE FOR windTurbines TYPE File SET("JSON" AS PARSER.`TYPE`);
ATTACH FILE large/debs/WIND_TURBINES_TOPIC_5M.csv

SELECT producerId, groupId, producedPower, timestamp FROM windTurbines INTO Checksum();
----
ERROR 4000
