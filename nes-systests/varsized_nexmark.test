# name: milestone/Nexmark_multiple_GB_of_Bids.test
# description: Nexmark benchmark taken from https://github.com/nexmark/nexmark/tree/master/nexmark-flink/src/main/resources/queries
# We have used https://github.com/risingwavelabs/nexmark-rs to generate the source csv files
# groups: [milestone, benchmark, large, Aggregation, Join]

# Source definition. We have removed some columns that are not needed in our queries
CREATE LOGICAL SOURCE bid(timestamp UINT64, auctionId INT32, bidder INT32, price FLOAT64);
CREATE PHYSICAL SOURCE FOR bid TYPE File;
ATTACH FILE large/nexmark/bid_6GB.csv

CREATE LOGICAL SOURCE auction(timestamp UINT64, id INT32, initialbid INT32, reserve INT32, expires UINT64, seller INT32, category INT32);
CREATE PHYSICAL SOURCE FOR auction TYPE File;
ATTACH FILE large/nexmark/auction_707MB.csv

CREATE LOGICAL SOURCE person(id INT32, name VARSIZED, email_address VARSIZED, credit_card VARSIZED, city VARSIZED, state VARSIZED, timestamp UINT64, extra VARSIZED);
CREATE PHYSICAL SOURCE FOR person TYPE File;
ATTACH FILE large/nexmark/person_840MB.csv

CREATE SINK personCheckSum(person.id INT32, person.name VARSIZED, person.email_address VARSIZED, person.credit_card VARSIZED, person.city VARSIZED, person.state VARSIZED, person.timestamp UINT64, person.extra VARSIZED)  TYPE Checksum;
CREATE SINK personIdSum(person.id INT32) TYPE Checksum;

# Query 0
SELECT * FROM person INTO personCheckSum;
----
4000000 85430084707


SELECT id FROM person WHERE CONCAT(city, state) == VARSIZED("redmondwy") OR CONCAT(city,state) == VARSIZED("portlandca") INTO personIdSum;
----
133343 48170045