# name: inline/InlineEventMixed.test
# description: Mix of inline and inline-event queries to stress restart handling
# groups: [InlineEvent, Aggregation]

CREATE LOGICAL SOURCE stream(i64 INT64, ts UINT64);
CREATE PHYSICAL SOURCE FOR stream TYPE TCP;
ATTACH INLINE
1,0
2,50
3,120

CREATE LOGICAL SOURCE stream2(i64 INT64, ts UINT64);
CREATE PHYSICAL SOURCE FOR stream2 TYPE TCP;
ATTACH INLINE
10,0
<CRASH>
11,30
<RESTART>
12,60

CREATE SINK sinkAggEvent(stream.start UINT64, stream.end UINT64, stream.i64_out UINT64) TYPE File;
CREATE SINK sinkAggEvent2(stream2.start UINT64, stream2.end UINT64, stream2.i64_out UINT64) TYPE File;

SELECT start, end, COUNT(i64) as i64_out FROM stream WINDOW TUMBLING(ts, size 100 ms) INTO sinkAggEvent;
----
0,100,2
100,200,1

SELECT start, end, COUNT(i64) as i64_out FROM stream2 WINDOW TUMBLING(ts, size 100 ms) INTO sinkAggEvent2;
----
0,100,2
