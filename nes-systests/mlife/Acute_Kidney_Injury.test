# name: window/WindowAggregationDifferentDataTypesKeyed.test
# description: Test window aggregations over different data types for keyed windows
# groups: [Aggregation, WindowOperators]

# 60000 = 1min
# 86400000 = 1 day
# 43200000 = 1/2 day
CREATE LOGICAL SOURCE stream(keyI8 INT8, f64 FLOAT64, ts UINT64);
CREATE PHYSICAL SOURCE FOR stream TYPE File;
ATTACH INLINE
# Day 1
1,1,43200000
# Day 2
1,2,129600000
# Day 3
1,3,216000000
# Day 4
1,4,302400000
# Day 5
1,5,388800000
# Day 6
1,6,475200000
# Day 7
1,7,561600000
# Day 8
1,16,648000000
# Day 9
1,17,734400000
# Day 10
1,18,820800000


# AND end1day >= end7days
SELECT max1day, max7days FROM (SELECT start, end as end7days, keyI8 as id, MAX(f64) as max7days FROM stream GROUP BY (keyI8) WINDOW SLIDING(ts, size 7 day, advance by 1 day)) INNER JOIN
(SELECT start, end as end1day, keyI8 as id2, MAX(f64) as max1day FROM stream GROUP BY (keyI8) WINDOW TUMBLING(ts, size 1 day))
ON (id = id2 AND end1day > end7days AND max1day > (FLOAT64(2) * max7days)) WINDOW SLIDING (start, size 8 day, advance by 1 day) INTO File();
----
16.0,7.0

#2.0,7.0
#3.0,7.0

