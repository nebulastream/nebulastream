# name: join/JoinMultipleKeys.test
# description: Test join operator with multiple join keys
# groups: [WindowOperators, Join]

Source stream UINT64 id UINT64 value UINT64 timestamp
Source stream2 UINT64 id2 UINT64 value2 UINT64 timestamp
Source stream3 UINT64 id3 UINT64 value3 UINT64 timestamp
Source stream4 UINT64 id4 UINT64 value4 UINT64 timestamp
Source stream5 UINT64 id5 UINT64 value5 UINT64 timestamp
Source stream6 UINT64 id6 UINT64 value6 UINT64 timestamp
Source stream7 UINT64 id7 UINT64 value7 UINT64 timestamp
Source stream8 UINT64 id8 UINT64 value8 UINT64 timestamp

Attach TCP CSV stream GENERATOR
CONFIG/sources/tcp_gen.yaml
Attach TCP CSV stream2 GENERATOR
CONFIG/sources/tcp_gen.yaml
Attach TCP CSV stream3 GENERATOR
CONFIG/sources/tcp_gen.yaml
Attach TCP CSV stream4 GENERATOR
CONFIG/sources/tcp_gen.yaml
Attach TCP CSV stream5 GENERATOR
CONFIG/sources/tcp_gen.yaml
Attach TCP CSV stream6 GENERATOR
CONFIG/sources/tcp_gen.yaml
Attach TCP CSV stream7 GENERATOR
CONFIG/sources/tcp_gen.yaml
Attach TCP CSV stream8 GENERATOR
CONFIG/sources/tcp_gen.yaml

SINK sink TYPE Checksum UINT64 stream$id

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001, 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001, 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001, 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001, 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001, 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001, 41217020

SELECT id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
)
INTO sink;
----
100001, 41217020