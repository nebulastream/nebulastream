# name: join/JoinMultipleKeys.test
# description: Test join operator with multiple join keys
# groups: [WindowOperators, Join]

# Source definitions
SourceCSV stream UINT64 id UINT64 value UINT64 timestamp TESTDATA/stream.csv
SourceCSV stream2 UINT64 id2 UINT64 value2 UINT64 timestamp TESTDATA/stream2.csv

SINK sinkStreamStream2 UINT64 streamstream2$start UINT64 streamstream2$end UINT64 stream$id UINT64 stream$value UINT64 stream$timestamp UINT64 stream2$id2 UINT64 stream2$value2 UINT64 stream2$timestamp


# Query 1 - Join two streams
SELECT * FROM (SELECT * FROM stream) INNER JOIN (SELECT * FROM stream2) ON (id = id2 AND value = value2) WINDOW TUMBLING (timestamp, size 1 sec) INTO sinkStreamStream2;
----
2000 3000 1 2 2000 1 2 2010
2000 3000 11 2 2001 11 2 2301
3000 4000 1 3 3000 1 3 3009
3000 4000 1 3 3000 1 3 3201
3000 4000 11 3 3001 11 3 3001
3000 4000 1 3 3003 1 3 3009
3000 4000 1 3 3003 1 3 3201
3000 4000 1 3 3200 1 3 3009
3000 4000 1 3 3200 1 3 3201
4000 5000 1 4 4000 1 4 4001
5000 6000 1 5 5000 1 5 5500
6000 7000 1 6 6000 1 6 6000
7000 8000 1 7 7000 1 7 7000
8000 9000 1 8 8000 1 8 8000
9000 10000 1 9 9000 1 9 9000
10000 11000 1 10 10000 1 10 10000
11000 12000 1 11 11000 1 11 11000
12000 13000 1 12 12000 1 12 12000
13000 14000 1 13 13000 1 13 13000
14000 15000 1 14 14000 1 14 14000
15000 16000 1 15 15000 1 15 15000
16000 17000 1 16 16000 1 16 16000
17000 18000 1 17 17000 1 17 17000
18000 19000 1 18 18000 1 18 18000
19000 20000 1 19 19000 1 19 19000
20000 21000 1 20 20000 1 20 20000
21000 22000 1 21 21000 1 21 21000
