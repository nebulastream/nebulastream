# name: join/JoinMultipleStreams.test
# description: Test join operator
# groups: [WindowOperators, Join]

# Source definitions
Source stream UINT64 id UINT64 value UINT64 timestamp FILE
TESTDATA/small/stream.csv

Source stream2 UINT64 id2 UINT64 value2 UINT64 timestamp FILE
TESTDATA/small/stream2.csv

Source stream4 UINT64 id4 UINT64 value4 UINT64 timestamp FILE
TESTDATA/small/stream4.csv

Source stream4_1 UINT64 id4_1 UINT64 value4_1 UINT64 timestamp FILE
TESTDATA/small/stream4.csv

Source stream7 UINT64 id7 UINT64 value7 UINT64 timestamp FILE
TESTDATA/small/stream7.csv

Source stream7_1 UINT64 id7_1 UINT64 value7_1 UINT64 timestamp FILE
TESTDATA/small/stream7.csv

SINK sinkStreamStream2 UINT64 streamstream2$start UINT64 streamstream2$end UINT64 stream$id UINT64 stream$value UINT64 stream$timestamp UINT64 stream2$id2 UINT64 stream2$value2 UINT64 stream2$timestamp
SINK sinkStreamStream2Stream4 UINT64 streamstream2stream4$start  UINT64 streamstream2stream4$end  UINT64 streamstream2$start  UINT64 streamstream2$end  UINT64 stream$id  UINT64 stream$value  UINT64 stream$timestamp  UINT64 stream2$id2  UINT64 stream2$value2  UINT64 stream2$timestamp  UINT64 stream4$id4  UINT64 stream4$value4  UINT64 stream4$timestamp
SINK sinkStreamStream2Stream4Stream4_1 UINT64 streamstream2stream4stream4_1$start UINT64 streamstream2stream4stream4_1$end	 UINT64 streamstream2stream4$start	 UINT64 streamstream2stream4$end	 UINT64 streamstream2$start	 UINT64 streamstream2$end	 UINT64 stream$id	 UINT64 stream$value	 UINT64 stream$timestamp	 UINT64 stream2$id2	 UINT64 stream2$value2	 UINT64 stream2$timestamp	 UINT64 stream4$id4	 UINT64 stream4$value4	 UINT64 stream4$timestamp	 UINT64 stream4_1$id4_1	 UINT64 stream4_1$value4_1	 UINT64 stream4_1$timestamp
SINK sinkStream7Stream7_1 UINT64 stream7stream7_1$start UINT64 stream7stream7_1$end UINT64 stream7$id7 UINT64 stream7$value7 UINT64 stream7$timestamp UINT64 stream7_1$id7_1 UINT64 stream7_1$value7_1 UINT64 stream7_1$timestamp

# Query 1 - Join two streams
SELECT * FROM (SELECT * FROM stream) INNER JOIN (SELECT * FROM stream2) ON id = id2 WINDOW TUMBLING (timestamp, size 1 sec) INTO sinkStreamStream2;
----
1000 2000 12 1 1001 12 5 1011
1000 2000 4 1 1002 4 3 1102
1000 2000 4 1 1002 4 3 1112
2000 3000 1 2 2000 1 2 2010
2000 3000 11 2 2001 11 2 2301
3000 4000 1 3 3000 1 3 3009
3000 4000 1 3 3000 1 3 3201
3000 4000 11 3 3001 11 3 3001
3000 4000 1 3 3003 1 3 3009
3000 4000 1 3 3003 1 3 3201
3000 4000 1 3 3200 1 3 3009
3000 4000 1 3 3200 1 3 3201
4000 5000 1 4 4000 1 4 4001
5000 6000 1 5 5000 1 5 5500
6000 7000 1 6 6000 1 6 6000
7000 8000 1 7 7000 1 7 7000
8000 9000 1 8 8000 1 8 8000
9000 10000 1 9 9000 1 9 9000
10000 11000 1 10 10000 1 10 10000
11000 12000 1 11 11000 1 11 11000
12000 13000 1 12 12000 1 12 12000
13000 14000 1 13 13000 1 13 13000
14000 15000 1 14 14000 1 14 14000
15000 16000 1 15 15000 1 15 15000
16000 17000 1 16 16000 1 16 16000
17000 18000 1 17 17000 1 17 17000
18000 19000 1 18 18000 1 18 18000
19000 20000 1 19 19000 1 19 19000
20000 21000 1 20 20000 1 20 20000
21000 22000 1 21 21000 1 21 21000

# Query 2 - Join three streams
SELECT * FROM (SELECT * FROM stream)
 INNER JOIN (SELECT * FROM stream2) ON id = id2 WINDOW TUMBLING (timestamp, size 1 sec)
 INNER JOIN (SELECT * FROM stream4) ON id = id4 WINDOW TUMBLING (timestamp, size 1 sec)
 INTO sinkStreamStream2Stream4;
----
1000 2000 1000 2000 4 1 1002 4 3 1112 4 4 1001
1000 2000 1000 2000 4 1 1002 4 3 1102 4 4 1001
1000 2000 1000 2000 12 1 1001 12 5 1011 12 1 1300
3000 4000 3000 4000 11 3 3001 11 3 3001 11 9 3000
12000 13000 12000 13000 1 12 12000 1 12 12000 1 12 12000
13000 14000 13000 14000 1 13 13000 1 13 13000 1 13 13000
14000 15000 14000 15000 1 14 14000 1 14 14000 1 14 14000
15000 16000 15000 16000 1 15 15000 1 15 15000 1 15 15000

# Query 3 - Join four streams
SELECT * FROM (SELECT * FROM stream)
 INNER JOIN (SELECT * FROM stream2) ON id = id2 WINDOW TUMBLING (timestamp, size 1 sec)
 INNER JOIN (SELECT * FROM stream4) ON id = id4 WINDOW TUMBLING (timestamp, size 1 sec)
 INNER JOIN (SELECT * FROM stream4_1) ON id = id4_1 WINDOW TUMBLING (timestamp, size 1 sec)
 INTO sinkStreamStream2Stream4Stream4_1;
----
12000 13000 12000 13000 12000 13000 1 12 12000 1 12 12000 1 12 12000 1 12 12000
13000 14000 13000 14000 13000 14000 1 13 13000 1 13 13000 1 13 13000 1 13 13000
14000 15000 14000 15000 14000 15000 1 14 14000 1 14 14000 1 14 14000 1 14 14000
15000 16000 15000 16000 15000 16000 1 15 15000 1 15 15000 1 15 15000 1 15 15000
3000 4000 3000 4000 3000 4000 11 3 3001 11 3 3001 11 9 3000 11 9 3000
1000 2000 1000 2000 1000 2000 4 1 1002 4 3 1102 4 4 1001 4 4 1001
1000 2000 1000 2000 1000 2000 4 1 1002 4 3 1112 4 4 1001 4 4 1001
1000 2000 1000 2000 1000 2000 12 1 1001 12 5 1011 12 1 1300 12 1 1300

# Query 4 - Join two streams with a sliding stream
SELECT * FROM (SELECT * FROM stream7)
 INNER JOIN (SELECT * FROM stream7_1) ON id7 = id7_1 WINDOW SLIDING (timestamp, size 1 sec, advance by 250 ms)
 INTO sinkStream7Stream7_1;
----
250 1250 1 1 1240 1 1 1240
250 1250 4 2 1120 4 2 1120
250 1250 12 3 1180 12 3 1180
500 1500 1 1 1240 1 1 1240
500 1500 4 2 1120 4 2 1120
500 1500 12 3 1180 12 3 1180
500 1500 4 2 1120 4 6 1480
500 1500 12 3 1180 12 5 1475
500 1500 12 5 1475 12 3 1180
500 1500 4 6 1480 4 2 1120
500 1500 12 5 1475 12 5 1475
500 1500 4 6 1480 4 6 1480
500 1500 5 7 1350 5 7 1350
750 1750 1 1 1240 1 1 1240
750 1750 4 2 1120 4 2 1120
750 1750 12 3 1180 12 3 1180
750 1750 4 2 1120 4 6 1480
750 1750 12 3 1180 12 5 1475
750 1750 12 3 1180 12 4 1501
750 1750 12 5 1475 12 3 1180
750 1750 4 6 1480 4 2 1120
750 1750 12 5 1475 12 5 1475
750 1750 4 6 1480 4 6 1480
750 1750 5 7 1350 5 7 1350
750 1750 12 5 1475 12 4 1501
750 1750 12 4 1501 12 3 1180
750 1750 12 4 1501 12 5 1475
750 1750 12 4 1501 12 4 1501
750 1750 3 10 1650 3 10 1650
1000 2000 1 1 1240 1 1 1240
1000 2000 4 2 1120 4 2 1120
1000 2000 12 3 1180 12 3 1180
1000 2000 4 2 1120 4 6 1480
1000 2000 12 3 1180 12 5 1475
1000 2000 12 3 1180 12 4 1501
1000 2000 1 1 1240 1 9 1999
1000 2000 12 5 1475 12 3 1180
1000 2000 4 6 1480 4 2 1120
1000 2000 12 5 1475 12 5 1475
1000 2000 4 6 1480 4 6 1480
1000 2000 5 7 1350 5 7 1350
1000 2000 12 5 1475 12 4 1501
1000 2000 5 7 1350 5 8 1750
1000 2000 12 4 1501 12 3 1180
1000 2000 12 4 1501 12 5 1475
1000 2000 12 4 1501 12 4 1501
1000 2000 3 10 1650 3 10 1650
1000 2000 1 9 1999 1 1 1240
1000 2000 5 8 1750 5 7 1350
1000 2000 5 8 1750 5 8 1750
1000 2000 1 9 1999 1 9 1999
1000 2000 20 12 1987 20 12 1987
1250 2250 12 5 1475 12 5 1475
1250 2250 4 6 1480 4 6 1480
1250 2250 5 7 1350 5 7 1350
1250 2250 12 5 1475 12 4 1501
1250 2250 5 7 1350 5 8 1750
1250 2250 12 4 1501 12 5 1475
1250 2250 12 4 1501 12 4 1501
1250 2250 3 10 1650 3 10 1650
1250 2250 3 10 1650 3 11 2240
1250 2250 5 8 1750 5 7 1350
1250 2250 5 8 1750 5 8 1750
1250 2250 1 9 1999 1 9 1999
1250 2250 20 12 1987 20 12 1987
1250 2250 20 12 1987 20 13 2010
1250 2250 3 11 2240 3 10 1650
1250 2250 20 13 2010 20 12 1987
1250 2250 3 11 2240 3 11 2240
1250 2250 20 13 2010 20 13 2010
1250 2250 17 14 2200 17 14 2200
1500 2500 12 4 1501 12 4 1501
1500 2500 3 10 1650 3 10 1650
1500 2500 3 10 1650 3 11 2240
1500 2500 5 8 1750 5 8 1750
1500 2500 1 9 1999 1 9 1999
1500 2500 20 12 1987 20 12 1987
1500 2500 20 12 1987 20 13 2010
1500 2500 3 11 2240 3 10 1650
1500 2500 20 13 2010 20 12 1987
1500 2500 3 11 2240 3 11 2240
1500 2500 20 13 2010 20 13 2010
1500 2500 17 14 2200 17 14 2200
1500 2500 42 17 2400 42 17 2400
1750 2750 5 8 1750 5 8 1750
1750 2750 1 9 1999 1 9 1999
1750 2750 20 12 1987 20 12 1987
1750 2750 20 12 1987 20 13 2010
1750 2750 20 13 2010 20 12 1987
1750 2750 3 11 2240 3 11 2240
1750 2750 20 13 2010 20 13 2010
1750 2750 17 14 2200 17 14 2200
1750 2750 17 14 2200 17 15 2600
1750 2750 42 17 2400 42 17 2400
1750 2750 17 15 2600 17 14 2200
1750 2750 17 15 2600 17 15 2600
2000 3000 3 11 2240 3 11 2240
2000 3000 20 13 2010 20 13 2010
2000 3000 17 14 2200 17 14 2200
2000 3000 17 14 2200 17 15 2600
2000 3000 17 14 2200 17 16 2800
2000 3000 42 17 2400 42 17 2400
2000 3000 42 17 2400 42 18 2990
2000 3000 17 15 2600 17 14 2200
2000 3000 17 15 2600 17 15 2600
2000 3000 17 15 2600 17 16 2800
2000 3000 17 16 2800 17 14 2200
2000 3000 42 18 2990 42 17 2400
2000 3000 17 16 2800 17 15 2600
2000 3000 17 16 2800 17 16 2800
2000 3000 42 18 2990 42 18 2990
2250 3250 42 17 2400 42 17 2400
2250 3250 42 17 2400 42 18 2990
2250 3250 17 15 2600 17 15 2600
2250 3250 17 15 2600 17 16 2800
2250 3250 42 18 2990 42 17 2400
2250 3250 17 16 2800 17 15 2600
2250 3250 17 16 2800 17 16 2800
2250 3250 42 18 2990 42 18 2990
2500 3500 17 15 2600 17 15 2600
2500 3500 17 15 2600 17 16 2800
2500 3500 17 16 2800 17 15 2600
2500 3500 17 16 2800 17 16 2800
2500 3500 42 18 2990 42 18 2990
2750 3750 17 16 2800 17 16 2800
2750 3750 42 18 2990 42 18 2990

# Query 5 - Join three streams with a sliding stream
SELECT * FROM (SELECT * FROM stream)
 INNER JOIN (SELECT * FROM stream2) ON id = id2 WINDOW SLIDING (timestamp, size 1 sec, advance by 500 ms)
 INNER JOIN (SELECT * FROM stream4) ON id = id4 WINDOW SLIDING (timestamp, size 1 sec, advance by 500 ms)
 INNER JOIN (SELECT * FROM stream4_1) ON id = id4_1 WINDOW SLIDING (timestamp, size 1 sec, advance by 500 ms)
 INTO sinkStreamStream2Stream4Stream4_1;
----
500 1500 500 1500 500 1500 12 1 1001 12 5 1011 12 1 1300 12 1 1300
500 1500 500 1500 500 1500 4 1 1002 4 3 1102 4 4 1001 4 4 1001
500 1500 500 1500 500 1500 4 1 1002 4 3 1112 4 4 1001 4 4 1001
500 1500 500 1500 1000 2000 12 1 1001 12 5 1011 12 1 1300 12 1 1300
500 1500 500 1500 1000 2000 4 1 1002 4 3 1102 4 4 1001 4 4 1001
500 1500 500 1500 1000 2000 4 1 1002 4 3 1112 4 4 1001 4 4 1001
500 1500 1000 2000 500 1500 12 1 1001 12 5 1011 12 1 1300 12 1 1300
500 1500 1000 2000 500 1500 4 1 1002 4 3 1102 4 4 1001 4 4 1001
500 1500 1000 2000 500 1500 4 1 1002 4 3 1112 4 4 1001 4 4 1001
500 1500 1000 2000 1000 2000 12 1 1001 12 5 1011 12 1 1300 12 1 1300
500 1500 1000 2000 1000 2000 4 1 1002 4 3 1102 4 4 1001 4 4 1001
500 1500 1000 2000 1000 2000 4 1 1002 4 3 1112 4 4 1001 4 4 1001
1000 2000 500 1500 500 1500 12 1 1001 12 5 1011 12 1 1300 12 1 1300
1000 2000 500 1500 500 1500 4 1 1002 4 3 1102 4 4 1001 4 4 1001
1000 2000 500 1500 500 1500 4 1 1002 4 3 1112 4 4 1001 4 4 1001
1000 2000 500 1500 1000 2000 12 1 1001 12 5 1011 12 1 1300 12 1 1300
1000 2000 500 1500 1000 2000 4 1 1002 4 3 1102 4 4 1001 4 4 1001
1000 2000 500 1500 1000 2000 4 1 1002 4 3 1112 4 4 1001 4 4 1001
1000 2000 1000 2000 500 1500 12 1 1001 12 5 1011 12 1 1300 12 1 1300
1000 2000 1000 2000 500 1500 4 1 1002 4 3 1102 4 4 1001 4 4 1001
1000 2000 1000 2000 500 1500 4 1 1002 4 3 1112 4 4 1001 4 4 1001
1000 2000 1000 2000 1000 2000 12 1 1001 12 5 1011 12 1 1300 12 1 1300
1000 2000 1000 2000 1000 2000 4 1 1002 4 3 1102 4 4 1001 4 4 1001
1000 2000 1000 2000 1000 2000 4 1 1002 4 3 1112 4 4 1001 4 4 1001
2500 3500 2500 3500 2500 3500 11 3 3001 11 3 3001 11 9 3000 11 9 3000
2500 3500 2500 3500 3000 4000 11 3 3001 11 3 3001 11 9 3000 11 9 3000
2500 3500 3000 4000 2500 3500 11 3 3001 11 3 3001 11 9 3000 11 9 3000
2500 3500 3000 4000 3000 4000 11 3 3001 11 3 3001 11 9 3000 11 9 3000
3000 4000 2500 3500 2500 3500 11 3 3001 11 3 3001 11 9 3000 11 9 3000
3000 4000 2500 3500 3000 4000 11 3 3001 11 3 3001 11 9 3000 11 9 3000
3000 4000 3000 4000 2500 3500 11 3 3001 11 3 3001 11 9 3000 11 9 3000
3000 4000 3000 4000 3000 4000 11 3 3001 11 3 3001 11 9 3000 11 9 3000
11500 12500 11500 12500 11500 12500 1 12 12000 1 12 12000 1 12 12000 1 12 12000
11500 12500 11500 12500 12000 13000 1 12 12000 1 12 12000 1 12 12000 1 12 12000
11500 12500 12000 13000 11500 12500 1 12 12000 1 12 12000 1 12 12000 1 12 12000
11500 12500 12000 13000 12000 13000 1 12 12000 1 12 12000 1 12 12000 1 12 12000
12000 13000 11500 12500 11500 12500 1 12 12000 1 12 12000 1 12 12000 1 12 12000
12000 13000 11500 12500 12000 13000 1 12 12000 1 12 12000 1 12 12000 1 12 12000
12000 13000 12000 13000 11500 12500 1 12 12000 1 12 12000 1 12 12000 1 12 12000
12000 13000 12000 13000 12000 13000 1 12 12000 1 12 12000 1 12 12000 1 12 12000
12500 13500 12500 13500 12500 13500 1 13 13000 1 13 13000 1 13 13000 1 13 13000
12500 13500 12500 13500 13000 14000 1 13 13000 1 13 13000 1 13 13000 1 13 13000
12500 13500 13000 14000 12500 13500 1 13 13000 1 13 13000 1 13 13000 1 13 13000
12500 13500 13000 14000 13000 14000 1 13 13000 1 13 13000 1 13 13000 1 13 13000
13000 14000 12500 13500 12500 13500 1 13 13000 1 13 13000 1 13 13000 1 13 13000
13000 14000 12500 13500 13000 14000 1 13 13000 1 13 13000 1 13 13000 1 13 13000
13000 14000 13000 14000 12500 13500 1 13 13000 1 13 13000 1 13 13000 1 13 13000
13000 14000 13000 14000 13000 14000 1 13 13000 1 13 13000 1 13 13000 1 13 13000
13500 14500 13500 14500 13500 14500 1 14 14000 1 14 14000 1 14 14000 1 14 14000
13500 14500 13500 14500 14000 15000 1 14 14000 1 14 14000 1 14 14000 1 14 14000
13500 14500 14000 15000 13500 14500 1 14 14000 1 14 14000 1 14 14000 1 14 14000
13500 14500 14000 15000 14000 15000 1 14 14000 1 14 14000 1 14 14000 1 14 14000
14000 15000 13500 14500 13500 14500 1 14 14000 1 14 14000 1 14 14000 1 14 14000
14000 15000 13500 14500 14000 15000 1 14 14000 1 14 14000 1 14 14000 1 14 14000
14000 15000 14000 15000 13500 14500 1 14 14000 1 14 14000 1 14 14000 1 14 14000
14000 15000 14000 15000 14000 15000 1 14 14000 1 14 14000 1 14 14000 1 14 14000
14500 15500 14500 15500 14500 15500 1 15 15000 1 15 15000 1 15 15000 1 15 15000
14500 15500 14500 15500 15000 16000 1 15 15000 1 15 15000 1 15 15000 1 15 15000
14500 15500 15000 16000 14500 15500 1 15 15000 1 15 15000 1 15 15000 1 15 15000
14500 15500 15000 16000 15000 16000 1 15 15000 1 15 15000 1 15 15000 1 15 15000
15000 16000 14500 15500 14500 15500 1 15 15000 1 15 15000 1 15 15000 1 15 15000
15000 16000 14500 15500 15000 16000 1 15 15000 1 15 15000 1 15 15000 1 15 15000
15000 16000 15000 16000 14500 15500 1 15 15000 1 15 15000 1 15 15000 1 15 15000
15000 16000 15000 16000 15000 16000 1 15 15000 1 15 15000 1 15 15000 1 15 15000
