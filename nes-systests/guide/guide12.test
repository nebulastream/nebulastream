# name: guide/guide12.test
# description: Sliding window inner join between orders and payments
# groups: [Window, Join, InnerJoin, Sliding]

CREATE LOGICAL SOURCE orders(
    order_id    INT64 NOT NULL,
    customer_id INT64 NOT NULL,
    ts          INT64 NOT NULL
);

CREATE LOGICAL SOURCE payments(
    payments_order_id INT64 NOT NULL,
    amount            FLOAT64 NOT NULL,
    ts                INT64 NOT NULL
);

CREATE PHYSICAL SOURCE FOR orders TYPE File;
ATTACH INLINE
1,42,10000

CREATE PHYSICAL SOURCE FOR payments TYPE File;
ATTACH INLINE
1,99.99,12000

CREATE SINK sink(
    `ORDERS$ORDER_ID`    INT64 NOT NULL,
    `ORDERS$CUSTOMER_ID` INT64 NOT NULL,
    `PAYMENTS$AMOUNT`    FLOAT64 NOT NULL
) TYPE File;

SELECT
    order_id,
    customer_id,
    amount
FROM (SELECT * FROM orders)
INNER JOIN (SELECT * FROM payments p)
ON order_id = payments_order_id
WINDOW SLIDING(ts, SIZE 30 SEC, ADVANCE BY 5 SEC)
INTO sink;
----
1,42,99.99
1,42,99.99
1,42,99.99
