GlobalConfiguration enable_event_trace: [true]
GlobalConfiguration worker.number_of_buffers_in_global_buffer_manager: [131072]
GlobalConfiguration worker.default_query_execution.operator_buffer_size: [16384]
GlobalConfiguration worker.query_engine.number_of_worker_threads: [16]

CREATE LOGICAL SOURCE solarPowerSource(timestamp UINT64, value FLOAT64);
CREATE PHYSICAL SOURCE FOR solarPowerSource TYPE File;
ATTACH FILE large/solar_power/solar-power.csv

CREATE SINK solarPowerVarsizedDiscard10(powerProdNext10Min VARSIZED) TYPE Discard;
CREATE SINK solarPowerVarsizedDiscard2(powerProdNext2Min VARSIZED) TYPE Discard;
CREATE SINK solarPowerVarsizedDiscard(powerProdNext8Sec VARSIZED) TYPE Discard;

MODEL minMaxScalerSolar TESTDATA/model/solar_power/preprocessor/scaler_solar.onnx
FLOAT64
FLOAT32 value_sc
BATCH_SIZE 1
CACHE NONE SIZE 1

MODEL dLinear_none TESTDATA/model/solar_power/pretrained/dlinear/dlinear_solar_size_60_stride_4.onnx
VARSIZED
VARSIZED powerProdNext8Sec
BATCH_SIZE 1
CACHE NONE SIZE 1

SELECT powerProdNext8Sec FROM (
    SELECT INFER_MODEL(dLinear_none, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerSolar, (value)) FROM solarPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 60000 ms, ADVANCE BY 4000 ms)
    )
) INTO solarPowerVarsizedDiscard;
----

MODEL dLinear_none TESTDATA/model/solar_power/pretrained/dlinear/dlinear_solar_size_3600_stride_300.onnx
VARSIZED
VARSIZED powerProdNext10Min
BATCH_SIZE 1
CACHE NONE SIZE 1

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear_none, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerSolar, (value)) FROM solarPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
)
INTO solarPowerVarsizedDiscard10;
----

MODEL dLinear_2q_16 TESTDATA/model/solar_power/pretrained/dlinear/dlinear_solar_size_600_stride_60.onnx
VARSIZED
VARSIZED powerProdNext2Min
BATCH_SIZE 1
CACHE NONE SIZE 1

SELECT powerProdNext2Min FROM (
    SELECT INFER_MODEL(dLinear_2q_16, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerSolar, (value)) FROM solarPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 600000 ms, ADVANCE BY 60000 ms)
    )
)
INTO solarPowerVarsizedDiscard2;
----
