# name: inference/wind_power/long_term.test
# description: Wind Power dataset experiments
# groups: [Inference, Experiments, TimeSeries, Wind, LongTerm, CacheTypeSize]

GlobalConfiguration enable_event_trace: [true]
GlobalConfiguration worker.number_of_buffers_in_global_buffer_manager: [131072]
GlobalConfiguration worker.default_query_execution.operator_buffer_size: [16384]
GlobalConfiguration worker.query_engine.number_of_worker_threads: [16]
GlobalConfiguration worker.default_query_execution.inference.batch_size: [1]

CREATE LOGICAL SOURCE windPowerSource(timestamp UINT64, value FLOAT64);
CREATE PHYSICAL SOURCE FOR windPowerSource TYPE File;
ATTACH FILE large/wind_power/wind-power.csv

CREATE SINK windPowerVarsizedDiscard(powerProdNext10Min VARSIZED) TYPE Discard;

CREATE MODEL minMaxScalerWind(
    PATH "TESTDATA/model/wind_power/preprocessor/scaler_wind.onnx"
    INPUTS (FLOAT64)
    OUTPUTS (value_sc FLOAT32)
);

CREATE MODEL dLinear(
    PATH "TESTDATA/model/wind_power/pretrained/dlinear/dlinear_wind_size_3600_stride_300.onnx"
    INPUTS (VARSIZED)
    OUTPUTS (powerProdNext10Min VARSIZED)
);

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [FIFO]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [16]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [FIFO]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [32]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [FIFO]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [64]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [FIFO]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [128]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LFU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [16]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LFU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [32]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LFU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [64]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LFU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [128]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LRU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [16]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LRU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [32]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LRU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [64]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [LRU]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [128]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [SECOND_CHANCE]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [16]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [SECOND_CHANCE]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [32]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [SECOND_CHANCE]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [64]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----

Configuration worker.default_query_execution.inference.prediction_cache_type: [SECOND_CHANCE]
Configuration worker.default_query_execution.inference.number_of_entries_prediction_cache: [128]

SELECT powerProdNext10Min FROM (
    SELECT INFER_MODEL(dLinear, (value_60_sec))
    FROM (
        SELECT ARRAY_AGG(value_sc) AS value_60_sec
        FROM (
            SELECT INFER_MODEL(minMaxScalerWind, (value)) FROM windPowerSource
        )
        WINDOW SLIDING(timestamp, SIZE 3600000 ms, ADVANCE BY 300000 ms)
    )
) INTO windPowerVarsizedDiscard;
----
