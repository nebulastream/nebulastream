# name: milestone/Manufacturing.test
# description: Manufacturing queries from the DEBS 2012 Grand Challenge
# groups: [milestone, benchmark, large]

# Source definitions
CREATE LOGICAL SOURCE manufacturing(creationTS UINT64 NOT NULL, messageIndex UINT64 NOT NULL, mf01 INT16 NOT NULL, mf02 INT16 NOT NULL, mf03 INT16 NOT NULL, pc13 INT16 NOT NULL, pc14 INT16 NOT NULL, pc15 INT16 NOT NULL, pc25 INT16 NOT NULL, pc26 INT16 NOT NULL, pc27 INT16 NOT NULL, res INT16 NOT NULL, bm05 INT16 NOT NULL, bm06 INT16 NOT NULL);
CREATE PHYSICAL SOURCE FOR manufacturing TYPE File;
ATTACH FILE large/manufacturing/manufacturing_1G.csv

CREATE SINK manufacturingChecksum(manufacturing.start UINT64 NOT NULL, manufacturing.end UINT64 NOT NULL, manufacturing.avg_mf01 FLOAT64 NOT NULL, manufacturing.sum_mf02 INT16 NOT NULL, manufacturing.min_mf03 INT16 NOT NULL, manufacturing.count_mf01 UINT64 NOT NULL, manufacturing.sum_mf01 INT16 NOT NULL)  TYPE Checksum ;


# Query 1 Windowed Aggregation with three different aggregation functions
SELECT start, end, AVG(mf01) AS avg_mf01, SUM(mf02) AS sum_mf02, MIN(mf03) AS min_mf03, COUNT(mf01) AS count_mf01, SUM(mf01) AS sum_mf01
FROM manufacturing
WINDOW SLIDING(creationTS, SIZE 1 MINUTE, ADVANCE BY 1 SEC)
INTO manufacturingChecksum;
----
221338, 698355948

