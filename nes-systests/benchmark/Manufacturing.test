# name: milestone/Manufacturing.test
# description: Manufacturing queries from the DEBS 2012 Grand Challenge
# groups: [milestone, benchmark, large]

# Source definitions
CREATE LOGICAL SOURCE manufacturing(creationTS UINT64, messageIndex UINT64, mf01 INT16, mf02 INT16, mf03 INT16, pc13 INT16, pc14 INT16, pc15 INT16, pc25 INT16, pc26 INT16, pc27 INT16, res INT16, bm05 INT16, bm06 INT16);
CREATE PHYSICAL SOURCE FOR manufacturing TYPE File;
ATTACH FILE large/manufacturing/manufacturing_1G.csv

CREATE SINK manufacturingChecksum(manufacturing.start UINT64, manufacturing.end UINT64, manufacturing.avg_mf01 FLOAT64, manufacturing.sum_mf02 INT16, manufacturing.min_mf03 INT16, manufacturing.count_mf01 UINT64, manufacturing.sum_mf01 INT16)  TYPE Checksum ;


# Query 1 Windowed Aggregation with three different aggregation functions
SELECT start, end, AVG(mf01) AS avg_mf01, SUM(mf02) AS sum_mf02, MIN(mf03) AS min_mf03, COUNT(mf01) AS count_mf01, SUM(mf01) AS sum_mf01
FROM manufacturing
WINDOW SLIDING(creationTS, SIZE 1 MINUTE, ADVANCE BY 1 SEC)
INTO manufacturingChecksum;
----
221338, 698355948

