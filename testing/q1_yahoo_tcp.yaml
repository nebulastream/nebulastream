#  SELECT user_id, page_id, campaign_id FROM tcp_source INTO csv_sink
query: |
  SELECT start, end, campaign_id, SUM(user_id) AS sum_user_id FROM tcp_source WHERE event_type < UINT64(1) GROUP BY campaign_id WINDOW TUMBLING(current_ms, SIZE 30 SEC) INTO csv_sink
logical:
  - name: tcp_source
    schema:
      - name: user_id
        type: UINT64
      - name: page_id
        type: UINT64
      - name: campaign_id
        type: UINT64
      - name: ad_type
        type: UINT64
      - name: event_type
        type: UINT64
      - name: current_ms
        type: UINT64
      - name: ip
        type: UINT64
      - name: d1
        type: UINT64
      - name: d2
        type: UINT64
      - name: d3
        type: UINT32
      - name: d4
        type: UINT16
physical:
  - logical: tcp_source
    type: BlockingTCP
    parserConfig:
      tupleDelimiter: "\n"
      fieldDelimiter: ","
      type: CSV
    sourceConfig:
      socketPort: 1111
      socketHost: localhost

sinks:
  name: csv_sink
  schema:
    - name: tcp_source$start
      type: UINT64
    - name: tcp_source$end
      type: UINT64
    - name: tcp_source$campaign_id
      type: UINT64
    - name: tcp_source$sum_user_id
      type: UINT64
  type: File
  config:
    inputFormat: CSV
    append: false
    filePath: "/home/rudi/dima/nebulastream-public/testing/output/outputQuery.csv"
