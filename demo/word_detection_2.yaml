query: |
  SELECT *
  FROM (
    SELECT start, SpeechRecognitionLabel(label_index) as label, COUNT(start) as freq
    FROM (
      SELECT start, end, ArgMax(output) as label_index 
      FROM ( 
        SELECT INFER_MODEL(speech_recognition, (chunked)) 
        FROM (
          SELECT start, end, ARRAY_AGG(value) as chunked
          FROM audio_stream
          WINDOW SLIDING(timestamp, size 1000000 sec, advance by 20000000 ms)
        )
      )
    ) WINDOW TUMBLING(start, size 1000000 sec)
    GROUP BY label_index
  )
  WHERE freq > UINT64(5)
  INTO file_sink
sink:
  name: file_sink
  type: File
  config:
    inputFormat: CSV
    filePath: word_detection_2.csv
logical:
  - name: audio_stream
    schema:
      - name: timestamp
        type: UINT64
      - name: value
        type: FLOAT32
physical:
  - logical: audio_stream
    parserConfig:
      type: Raw
    sourceConfig:
      type: Audio
      socketHost: localhost
      socketPort: 1234
      sampleRate: 16000
      sampleWidth: 2
models:
  - path: cmake-build-debug-docker/nes-systests/testdata/model/audio_model.onnx
    name: speech_recognition
    inputs:
      - VARSIZED
    outputs:
      - name: output
        type: VARSIZED
