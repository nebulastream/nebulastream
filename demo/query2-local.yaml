query: |
  SELECT start, end, id FROM (
    SELECT * FROM (SELECT * FROM stream)
    INNER JOIN (SELECT * FROM stream2)
    ON id = id2
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream3)
    ON id2 = id3
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream4)
    ON id3 = id4
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream5)
    ON id4 = id5
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream6)
    ON id5 = id6
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream7)
    ON id6 = id7
    WINDOW TUMBLING (timestamp, size 1 sec)
    INNER JOIN (SELECT * FROM stream8)
    ON id7 = id8
    WINDOW TUMBLING (timestamp, size 1 sec)
  )
  INTO sink;
sinks:
  - name: sink
    type: File
    config:
      filePath: /tmp/out.csv
      inputFormat: CSV
    schema:
      - name: streamstream2stream3stream4stream5stream6stream7stream8$start
        dataType: UINT64
      - name: streamstream2stream3stream4stream5stream6stream7stream8$end
        dataType: UINT64
      - name: stream$id
        dataType: UINT64
    host: worker-1:9090

logicalSources:
  - name: stream
    schema:
      - dataType: UINT64
        name: id
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream2
    schema:
      - dataType: UINT64
        name: id2
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream3
    schema:
      - dataType: UINT64
        name: id3
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream4
    schema:
      - dataType: UINT64
        name: id4
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream5
    schema:
      - dataType: UINT64
        name: id5
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream6
    schema:
      - dataType: UINT64
        name: id6
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream7
    schema:
      - dataType: UINT64
        name: id7
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream8
    schema:
      - dataType: UINT64
        name: id8
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp
  - name: stream9
    schema:
      - dataType: UINT64
        name: id9
      - dataType: UINT64
        name: value
      - dataType: UINT64
        name: timestamp

physicalSources:
  - logicalSource: stream
    host: worker-2:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      flushIntervalMS: 1
      socketType: SOCK_STREAM
      socketDomain: AF_INET
  - logicalSource: stream2
    host: worker-3:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      flushIntervalMS: 1
      socketType: SOCK_STREAM
      socketDomain: AF_INET
  - logicalSource: stream3
    host: worker-4:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      socketType: SOCK_STREAM
      flushIntervalMS: 1
      socketDomain: AF_INET
  - logicalSource: stream4
    host: worker-5:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      flushIntervalMS: 1
      socketType: SOCK_STREAM
      socketDomain: AF_INET
  - logicalSource: stream5
    host: worker-6:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      flushIntervalMS: 1
      socketType: SOCK_STREAM
      socketDomain: AF_INET
  - logicalSource: stream6
    host: worker-7:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      socketType: SOCK_STREAM
      flushIntervalMS: 1
      socketDomain: AF_INET
  - logicalSource: stream7
    host: worker-8:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      socketType: SOCK_STREAM
      flushIntervalMS: 1
      socketDomain: AF_INET
  - logicalSource: stream8
    host: worker-9:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      socketType: SOCK_STREAM
      socketDomain: AF_INET
      flushIntervalMS: 1
  - logicalSource: stream9
    host: worker-10:9090
    parserConfig:
      type: CSV
    type: TCP
    sourceConfig:
      socketHost: 127.0.0.1
      socketPort: 9999
      flushIntervalMS: 1
      socketType: SOCK_STREAM
      socketDomain: AF_INET

workerNodes:
  - host: worker-1:9090
    grpc: 127.0.0.1:8080
    capacity: 100
  - host: worker-2:9090
    grpc: 127.0.0.1:8081
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-3:9090
    grpc: 127.0.0.1:8082
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-4:9090
    grpc: 127.0.0.1:8083
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-5:9090
    grpc: 127.0.0.1:8084
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-6:9090
    grpc: 127.0.0.1:8085
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-7:9090
    grpc: 127.0.0.1:8086
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-8:9090
    grpc: 127.0.0.1:8087
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-9:9090
    grpc: 127.0.0.1:8088
    capacity: 0
    downstreamNodes:
      - worker-1:9090
  - host: worker-10:9090
    grpc: 127.0.0.1:8089
    capacity: 0
    downstreamNodes:
      - worker-1:9090
