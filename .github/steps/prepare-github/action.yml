name: prepare github ci server instance
description: |
  Prepares a github ci server instance by removing unnecessary pre-installed software pulling the docker image and 
  preparing ccache.

inputs:
  ccache_key:
    description: 'key of the ccache github cache'
    required: true
  image_name:
    description: 'name of the docker image to prepare'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Maximize build space
      shell: bash
      run: |
        $(which sudo) apt-get install -y ccache &
        docker pull ${{inputs.image_name}} &
        
        df -h
        sudo rm -rf /usr/share/dotnet
        sudo rm -rf /usr/local/lib/android
        sudo rm -rf /opt/ghc
        sudo rm -rf /opt/hostedtoolcache/CodeQL
        df -h
        wait
    - name: ccache
      uses: hendrikmuhs/ccache-action@v1.2.18
      with:
        key: ${{inputs.ccache_key}}
