# name: guide/guide7.test
# description: Max price per ticker in a sliding window
# groups: [Window, Aggregation, Sliding, Max]

CREATE LOGICAL SOURCE bid(
    ticker VARSIZED,
    price  FLOAT64,
    ts     INT64
);
CREATE PHYSICAL SOURCE FOR bid TYPE File;
ATTACH INLINE
AAPL,150.0,1
AAPL,152.0,2
AAPL,149.5,3
GOOG,1000.0,4
AAPL,153.0,5
GOOG,1010.0,6
GOOG,1005.0,7
AAPL,151.0,8

CREATE SINK sink(`BID$PRICE_MAX` FLOAT64) TYPE File;

SELECT
    MAX(price)
FROM bid
GROUP BY ticker
WINDOW SLIDING(ts, SIZE 10 SEC, ADVANCE BY 1 SEC)
INTO sink;
----
153.0
1010.0
