# name: bug/AggregationOfUnion.test
# description: Tests aggregation over union queries
# groups: [Aggregation, Union]

CREATE LOGICAL SOURCE stream(id UINT64, value UINT64, timestamp UINT64);
CREATE PHYSICAL SOURCE FOR stream TYPE File;
ATTACH INLINE
1,1,1000
1,1,1001
1,1,1002
1,1,1003

CREATE LOGICAL SOURCE stream2(id UINT64, value UINT64, timestamp UINT64);
CREATE PHYSICAL SOURCE FOR stream2 TYPE File;
ATTACH INLINE
2,2,2000
2,2,2001
2,2,2002
2,2,2003

CREATE LOGICAL SOURCE stream3(id UINT64, id2 UINT64, value UINT64, timestamp UINT64);
CREATE PHYSICAL SOURCE FOR stream3 TYPE File;
ATTACH INLINE
1,2,2,3000
1,2,2,3001
1,2,2,3002
1,2,2,3003

CREATE SINK sink4(max_id UINT64)  TYPE File;
SELECT MAX(id) as max_id
FROM (
    SELECT * FROM stream UNION SELECT * FROM stream2
)
WINDOW TUMBLING(timestamp, size 1 sec)
INTO sink4;
----
1
2

CREATE SINK sink5(max_id UINT64)  TYPE File;
SELECT MAX(id) as max_id
FROM (
    SELECT * FROM (SELECT * FROM stream UNION SELECT * FROM stream2)
)
WINDOW TUMBLING(timestamp, size 1 sec)
INTO sink5;
----
1
2

