From 1165a94c5aa78594f9c9ec018e7ee33499e1d76e Mon Sep 17 00:00:00 2001
From: Lukas Schwerdtfeger <lukas.schwerdtfeger@gmail.com>
Date: Fri, 2 Jan 2026 22:02:56 +0100
Subject: [PATCH] logging

---
 nautilus/src/nautilus/tracing/Snapshot.cpp    | 5 +++++
 nautilus/src/nautilus/tracing/Snapshot.hpp    | 3 +++
 nautilus/src/nautilus/tracing/TracerTrace.cpp | 1 +
 3 files changed, 9 insertions(+)

diff --git a/nautilus/src/nautilus/tracing/Snapshot.cpp b/nautilus/src/nautilus/tracing/Snapshot.cpp
index 2b73bb8..75daf95 100644
--- a/nautilus/src/nautilus/tracing/Snapshot.cpp
+++ b/nautilus/src/nautilus/tracing/Snapshot.cpp
@@ -1,4 +1,5 @@
 #include "nautilus/tracing/Snapshot.hpp"
+#include <fmt/format.h>
 
 namespace nautilus::tracing {
 
@@ -15,6 +16,10 @@ bool Snapshot::operator==(const nautilus::tracing::Snapshot& rhs) const {
 bool Snapshot::operator!=(const nautilus::tracing::Snapshot& rhs) const {
 	return !(rhs == *this);
 }
+
+std::string format_as(const Snapshot& tag) {
+	return fmt::format("{}:{}", tag.tag, tag.staticValueHash);
+}
 } // namespace nautilus::tracing
 
 namespace std {
diff --git a/nautilus/src/nautilus/tracing/Snapshot.hpp b/nautilus/src/nautilus/tracing/Snapshot.hpp
index 9972002..391d37b 100644
--- a/nautilus/src/nautilus/tracing/Snapshot.hpp
+++ b/nautilus/src/nautilus/tracing/Snapshot.hpp
@@ -22,9 +22,12 @@ public:
 
 private:
 	friend std::hash<Snapshot>;
+	friend std::string format_as(const Snapshot&);
 	uint64_t staticValueHash = 0;
 	TrieIndex tag = 0;
 };
+
+std::string format_as(const Snapshot& tag);
 } // namespace nautilus::tracing
 
 namespace std {
diff --git a/nautilus/src/nautilus/tracing/TracerTrace.cpp b/nautilus/src/nautilus/tracing/TracerTrace.cpp
index fc6a1ce..8ea3de3 100644
--- a/nautilus/src/nautilus/tracing/TracerTrace.cpp
+++ b/nautilus/src/nautilus/tracing/TracerTrace.cpp
@@ -199,6 +199,7 @@ Trace::Trace() {
 	capacity = 1024 * 1024 * 1024;
 }
 Trace::~Trace() {
+	fmt::println(stderr, "Used {}/{} bytes for trace", this->view->freeMemoryOffset.offset, this->capacity);
 	[[maybe_unused]] auto result = munmap(view, capacity);
 	assert(result == 0 && "Failed to unmap memory");
 }
-- 
2.50.0

