# name: projection/Projection.test
# description: Simple map tests with an add function
# groups: [Projection]

Source window UINT64 id UINT64 value UINT64 timestamp
1,1,1000
2,1,1001
3,1,1002
4,2,2000
5,19,19000
6,20,20000
7,21,21000

# 0: [id]
Query::from("window")
    .project(Attribute("id"))
    .SINK
----
1
2
3
4
5
6
7

# 1: [value]
Query::from("window")
    .project(Attribute("value"))
    .SINK
----
1
1
1
2
19
20
21

# 2: [timestamp]
Query::from("window")
    .project(Attribute("timestamp"))
    .SINK
----
1000
1001
1002
2000
19000
20000
21000

# 3: [id, value]
Query::from("window")
    .project(Attribute("id"), Attribute("timestamp"))
    .SINK
----
1,1000
2,1001
3,1002
4,2000
5,19000
6,20000
7,21000

# 4: [id, timestamp]
Query::from("window")
    .project(Attribute("id"), Attribute("timestamp"))
    .SINK
----
1,1000
2,1001
3,1002
4,2000
5,19000
6,20000
7,21000

# 5: [value, timestamp]
Query::from("window")
    .project(Attribute("value"), Attribute("timestamp"))
    .SINK
----
1,1000
1,1001
1,1002
2,2000
19,19000
20,20000
21,21000

# 6: [id, value, timestamp]
Query::from("window")
    .project(Attribute("id"), Attribute("value"), Attribute("timestamp"))
    .SINK
----
1,1,1000
2,1,1001
3,1,1002
4,2,2000
5,19,19000
6,20,20000
7,21,21000

# 7: [id, timestamp]
Query::from("window")
    .project(Attribute("timestamp"), Attribute("id"), Attribute("value"))
    .SINK
----
1000,1,1
1001,2,1
1002,3,1
2000,4,2
19000,5,19
20000,6,20
21000,7,21

# 8: [id, timestamp]
Query::from("window")
    .project(Attribute("value"), Attribute("timestamp"), Attribute("id"))
    .SINK
----
1,1000,1
1,1001,2
1,1002,3
2,2000,4
19,19000,5
20,20000,6
21,21000,7

# 9: [id, id -> new_field]
Query::from("window")
    .map(Attribute("new_field") = Attribute("id"))
    .project(Attribute("id"), Attribute("new_field"))
    .SINK
----
1,1
2,2
3,3
4,4
5,5
6,6
7,7

# 10: [id, value, id -> new_field]
Query::from("window")
    .map(Attribute("new_field") = Attribute("id"))
    .project(Attribute("id"), Attribute("value"), Attribute("new_field"))
    .SINK
----
1,1,1
2,1,2
3,1,3
4,2,4
5,19,5
6,20,6
7,21,7

# 11: [id, value, timestamp, id -> new_field]
Query::from("window")
    .map(Attribute("new_field") = Attribute("id"))
    .project(Attribute("id"), Attribute("value"), Attribute("timestamp"), Attribute("new_field"))
    .SINK
----
1,1,1000,1
2,1,1001,2
3,1,1002,3
4,2,2000,4
5,19,19000,5
6,20,20000,6
7,21,21000,7

# 12: [id -> new_field, id, value, timestamp]
Query::from("window")
    .map(Attribute("new_field") = Attribute("id"))
    .project(Attribute("new_field"), Attribute("id"), Attribute("value"), Attribute("timestamp"))
    .SINK
----
1,1,1,1000
2,2,1,1001
3,3,1,1002
4,4,2,2000
5,5,19,19000
6,6,20,20000
7,7,21,21000

# 13: [timestamp -> new_field, timestamp -> new_field, id, value, timestamp]
Query::from("window")
    .map(Attribute("new_field") = Attribute("timestamp"))
    .project(Attribute("new_field"), Attribute("new_field"), Attribute("id"), Attribute("value"), Attribute("timestamp"))
    .SINK
----
1000,1000,1,1,1000
1001,1001,2,1,1001
1002,1002,3,1,1002
2000,2000,4,2,2000
19000,19000,5,19,19000
20000,20000,6,20,20000
21000,21000,7,21,21000

## 14: [id -> new_field_1, id, value -> new_field_2, value, timestamp -> new_field_3, timestamp]
Query::from("window")
    .map(Attribute("new_field_1") = Attribute("id"))
    .map(Attribute("new_field_2") = Attribute("value"))
    .map(Attribute("new_field_3") = Attribute("timestamp"))
    .project(Attribute("new_field_1"), Attribute("id"), Attribute("new_field_2"), Attribute("value"), Attribute("new_field_3"), Attribute("timestamp"))
    .SINK
----
1,1,1,1,1000,1000
2,2,1,1,1001,1001
3,3,1,1,1002,1002
4,4,2,2,2000,2000
5,5,19,19,19000,19000
6,6,20,20,20000,20000
7,7,21,21,21000,21000
